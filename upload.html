<!DOCTYPE html>
<html>
<head>
    <title>Website Name Upload Site</title>
    <style>
        .drop-area {
            border: 2px dashed #ccc;
            width: 400px;
            height: 180px;
            text-align: center;
            padding: 20px;
            margin: 20px auto;
            border-radius: 10px;
            transition: background-color 0.2s, border-color 0.2s;
        }

        .drop-area.highlight {
            border-color: #6a5acd;
            background-color: #f0f0ff;
        }

        #file-input-badge, #file-input-zip {
            display: none;
        }

        .upload-btn {
            margin-top: 10px;
        }

        ul {
            color: red;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1 style="text-align: center;">Upload Badge ID List and ZIP File</h1>

    {% with messages = get_flashed_messages() %}
        {% if messages %}
            <ul>
                {% for message in messages %}
                    <li>{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}
    {% endwith %}

    <div id="drop-area-badge" class="drop-area">
	<p> Ballot Files Upload </p>
        <p>Drop <strong>.csv</strong> or <strong>.txt</strong> badge file here<br>or click to select</p>
        <input type="file" id="file-input-badge" accept=".csv,.txt">
        <button class="upload-btn" onclick="document.getElementById('file-input-badge').click()">Choose Badge File</button>
	<p class="file-name" id="badge-file-name"></p>
    </div>

    <div id="drop-area-zip" class="drop-area">
        <p> Badge Identification Document Upload </p>
	<p>Drop <strong>.zip</strong> image file here<br>or click to select</p>
        <input type="file" id="file-input-zip" accept=".zip">
        <button class="upload-btn" onclick="document.getElementById('file-input-zip').click()">Choose ZIP File</button>
	<p class="file-name" id="zip-file-name"></p>
    </div>
<div style="text-align: center; margin-top: 30px;">
        <button 
            style="padding: 12px 24px; font-size: 16px; border-radius: 8px; background-color: ##a6a6a6; color: white; border: none; cursor: pointer;"
            onclick="uploadFiles()"
        >
            Submit Files
        </button>
    </div>
	



<script>
    let badgeFile = null;
    let zipFile = null;

    const badgeArea = document.getElementById('drop-area-badge');
    const zipArea = document.getElementById('drop-area-zip');
    const badgeInput = document.getElementById('file-input-badge');
    const zipInput = document.getElementById('file-input-zip');

    const badgeFileNameDisplay = document.getElementById('badge-file-name');
    const zipFileNameDisplay = document.getElementById('zip-file-name');

    function isBadgeFile(file) {
        return file.name.toLowerCase().endsWith('.csv') || file.name.toLowerCase().endsWith('.txt');
    }

    function isZipFile(file) {
        return file.name.toLowerCase().endsWith('.zip');
    }

    function setupDropArea(area, input, fileCheckFn, onFileSelected) {
        ['dragenter', 'dragover'].forEach(event => {
            area.addEventListener(event, e => {
                e.preventDefault();
                e.stopPropagation();
                area.classList.add('highlight');
            }, false);
        });

        ['dragleave', 'drop'].forEach(event => {
            area.addEventListener(event, e => {
                e.preventDefault();
                e.stopPropagation();
                area.classList.remove('highlight');
            }, false);
        });

        area.addEventListener('drop', e => {
            const file = e.dataTransfer.files[0];
            if (!fileCheckFn(file)) {
                alert(`Invalid file type.`);
                return;
            }
            onFileSelected(file);
        });

        input.addEventListener('change', () => {
            const file = input.files[0];
            if (!fileCheckFn(file)) {
                alert(`Invalid file type.`);
                input.value = '';  // reset input
                return;
            }
            onFileSelected(file);
        });
    }

    setupDropArea(badgeArea, badgeInput, isBadgeFile, file => {
        badgeFile = file;
        badgeFileNameDisplay.textContent = `Selected file: ${file.name}`;
    });
    setupDropArea(zipArea, zipInput, isZipFile, file => {
        zipFile = file;
        zipFileNameDisplay.textContent = `Selected file: ${file.name}`;
    });

    function uploadFiles() {
        if (!badgeFile || !zipFile) {
            alert('Please provide both a badge file and a ZIP file.');
            return;
        }

        const formData = new FormData();
        formData.append('badge_file', badgeFile);
        formData.append('zip_file', zipFile);

        fetch("{{ url_for('upload_files') }}", {
            method: 'POST',
            body: formData
        })
        .then(response => {
            if (response.redirected) {
                window.location.href = response.url;
            } else {
                return response.text().then(data => {
                    alert('Upload failed. Check server logs or validations.');
                    console.log(data);
                });
            }
        })
        .catch(error => {
            console.error('Upload error:', error);
            alert('Upload failed.');
        });
    }
</script>

</body>
</html>
